<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>05 2012联邦选举委员会数据库 - 迭代自己</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="iterateself" />
  <meta name="description" content="14.5 2012 Federal Election Commission Database（2012联邦选举委员会数据库） 这个选举数据库对于政治宣传很有用。里面包含了支持者的名字，职业和雇主，地址，赞助金" />

  <meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.47.1" />


<link rel="canonical" href="http://iterate.site/post/01-%E7%9F%A5%E8%AF%86%E6%A0%91/03-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/01-%E5%9F%BA%E7%A1%80%E7%BC%96%E7%A8%8B/01-%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/02-python/03-python-%E7%A7%91%E5%AD%A6%E8%AE%A1%E7%AE%97/11-%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%BE%8B%E5%AD%90/05-2012%E8%81%94%E9%82%A6%E9%80%89%E4%B8%BE%E5%A7%94%E5%91%98%E4%BC%9A%E6%95%B0%E6%8D%AE%E5%BA%93/" />

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">




<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<link href="/dist/even.min.css?v=3.2.0" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">




<meta property="og:title" content="05 2012联邦选举委员会数据库" />
<meta property="og:description" content="14.5 2012 Federal Election Commission Database（2012联邦选举委员会数据库） 这个选举数据库对于政治宣传很有用。里面包含了支持者的名字，职业和雇主，地址，赞助金" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://iterate.site/post/01-%E7%9F%A5%E8%AF%86%E6%A0%91/03-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/01-%E5%9F%BA%E7%A1%80%E7%BC%96%E7%A8%8B/01-%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/02-python/03-python-%E7%A7%91%E5%AD%A6%E8%AE%A1%E7%AE%97/11-%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%BE%8B%E5%AD%90/05-2012%E8%81%94%E9%82%A6%E9%80%89%E4%B8%BE%E5%A7%94%E5%91%98%E4%BC%9A%E6%95%B0%E6%8D%AE%E5%BA%93/" /><meta property="article:published_time" content="2018-07-08T14:31:59&#43;00:00"/>
<meta property="article:modified_time" content="2018-07-08T14:31:59&#43;00:00"/>
<meta itemprop="name" content="05 2012联邦选举委员会数据库">
<meta itemprop="description" content="14.5 2012 Federal Election Commission Database（2012联邦选举委员会数据库） 这个选举数据库对于政治宣传很有用。里面包含了支持者的名字，职业和雇主，地址，赞助金">


<meta itemprop="datePublished" content="2018-07-08T14:31:59&#43;00:00" />
<meta itemprop="dateModified" content="2018-07-08T14:31:59&#43;00:00" />
<meta itemprop="wordCount" content="2951">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="05 2012联邦选举委员会数据库"/>
<meta name="twitter:description" content="14.5 2012 Federal Election Commission Database（2012联邦选举委员会数据库） 这个选举数据库对于政治宣传很有用。里面包含了支持者的名字，职业和雇主，地址，赞助金"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">迭代自己</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">最近</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">归档</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">关于</li>
      </a><a href="/catalog/">
        <li class="mobile-menu-item">完整目录</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">迭代自己</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">最近</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">归档</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">关于</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/catalog/">完整目录</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">05 2012联邦选举委员会数据库</h1>

      <div class="post-meta">
        <span class="post-time"> 2018-07-08 </span>
        
        <span class="more-meta"> 2951 words </span>
        <span class="more-meta"> 6 mins read </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> times read </span>
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  
  <div class="post-toc-content">
    <nav id="TableOfContents">
<ul>
<li><a href="#14-5-2012-federal-election-commission-database-2012联邦选举委员会数据库">14.5 2012 Federal Election Commission Database（2012联邦选举委员会数据库）</a></li>
<li><a href="#1-donation-statistics-by-occupation-and-employer-按职业与雇主划分的捐赠数据">1 Donation Statistics by Occupation and Employer（按职业与雇主划分的捐赠数据）</a></li>
<li><a href="#2-bucketing-donation-amounts-桶捐赠额">2 Bucketing Donation Amounts（桶捐赠额）</a></li>
<li><a href="#3-donation-statistics-by-state-按州划分的捐赠数据">3 Donation Statistics by State（按州划分的捐赠数据）</a></li>
</ul>
</nav>
  </div>
</div>

    
    

    
    <div class="post-content">
      

<h1 id="14-5-2012-federal-election-commission-database-2012联邦选举委员会数据库">14.5 2012 Federal Election Commission Database（2012联邦选举委员会数据库）</h1>

<p>这个选举数据库对于政治宣传很有用。里面包含了支持者的名字，职业和雇主，地址，赞助金额。一个有意思的数据集是关于2012年美国总统选举的。这个数据集有150MB，名称为P00000001-ALL.csv。（译者：因为github对于单个文件的上传限额是100MB，所以这个数据集无法推送到github上，这里我是把数据集压缩成了ZIP格式，解压后能正常导入）。我们用pandas来加载这个数据集：</p>

<pre><code class="language-python">import numpy as np
import pandas as pd
</code></pre>

<pre><code class="language-python">pd.options.display.max_rows = 10
</code></pre>

<pre><code class="language-python">fec = pd.read_csv('../datasets/fec/P00000001-ALL.csv', low_memory=False)
# 不设定low_memory=False的话会报错
</code></pre>

<pre><code class="language-python">fec.info()
</code></pre>

<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 1001731 entries, 0 to 1001730
Data columns (total 16 columns):
cmte_id              1001731 non-null object
cand_id              1001731 non-null object
cand_nm              1001731 non-null object
contbr_nm            1001731 non-null object
contbr_city          1001712 non-null object
contbr_st            1001727 non-null object
contbr_zip           1001620 non-null object
contbr_employer      988002 non-null object
contbr_occupation    993301 non-null object
contb_receipt_amt    1001731 non-null float64
contb_receipt_dt     1001731 non-null object
receipt_desc         14166 non-null object
memo_cd              92482 non-null object
memo_text            97770 non-null object
form_tp              1001731 non-null object
file_num             1001731 non-null int64
dtypes: float64(1), int64(1), object(14)
memory usage: 122.3+ MB
</code></pre>

<p>拿出一份记录来看是什么样子：</p>

<pre><code class="language-python">fec.iloc[123456]
</code></pre>

<pre><code>cmte_id             C00431445
cand_id             P80003338
cand_nm         Obama, Barack
contbr_nm         ELLMAN, IRA
contbr_city             TEMPE
                    ...
receipt_desc              NaN
memo_cd                   NaN
memo_text                 NaN
form_tp                 SA17A
file_num               772372
Name: 123456, Length: 16, dtype: object
</code></pre>

<p>我们可以已经能想到如何切割、整理数据，来提取赞助者的统计数据，或提取宣传活动的模式，这里我们展示一些不同的分析方法。</p>

<p>我们可以看到这里面没有政治党派（political party affiliations），所以我们最好添加这样的信息。我们可以使用unique得到所有候选人名单：</p>

<pre><code class="language-python">unique_cands = fec.cand_nm.unique()
unique_cands
</code></pre>

<pre><code>array(['Bachmann, Michelle', 'Romney, Mitt', 'Obama, Barack',
       &quot;Roemer, Charles E. 'Buddy' III&quot;, 'Pawlenty, Timothy',
       'Johnson, Gary Earl', 'Paul, Ron', 'Santorum, Rick', 'Cain, Herman',
       'Gingrich, Newt', 'McCotter, Thaddeus G', 'Huntsman, Jon',
       'Perry, Rick'], dtype=object)
</code></pre>

<pre><code class="language-python">unique_cands[2]
</code></pre>

<pre><code>'Obama, Barack'
</code></pre>

<p>一种标记政党的方法是使用dict：</p>

<pre><code class="language-python">parties = {'Bachmann, Michelle': 'Republican',
           'Cain, Herman': 'Republican',
           'Gingrich, Newt': 'Republican',
           'Huntsman, Jon': 'Republican',
           'Johnson, Gary Earl': 'Republican',
           'McCotter, Thaddeus G': 'Republican',
           'Obama, Barack': 'Democrat',
           'Paul, Ron': 'Republican',
           'Pawlenty, Timothy': 'Republican',
           'Perry, Rick': 'Republican',
           &quot;Roemer, Charles E. 'Buddy' III&quot;: 'Republican',
           'Romney, Mitt': 'Republican',
           'Santorum, Rick': 'Republican'}
</code></pre>

<p>用map方法，把这个映射应用到Series对象上，我们可以用候选者名字得到一个政党的数组：</p>

<pre><code class="language-python">fec.cand_nm[123456:123461]
</code></pre>

<pre><code>123456    Obama, Barack
123457    Obama, Barack
123458    Obama, Barack
123459    Obama, Barack
123460    Obama, Barack
Name: cand_nm, dtype: object
</code></pre>

<pre><code class="language-python">fec.cand_nm[123456:123461].map(parties)
</code></pre>

<pre><code>123456    Democrat
123457    Democrat
123458    Democrat
123459    Democrat
123460    Democrat
Name: cand_nm, dtype: object
</code></pre>

<pre><code class="language-python"># Add it as a column
fec['party'] = fec.cand_nm.map(parties)
</code></pre>

<pre><code class="language-python">fec['party'].value_counts()
</code></pre>

<pre><code>Democrat      593746
Republican    407985
Name: party, dtype: int64
</code></pre>

<p>一些需要注意的地方。首先，这个数据集中包含捐款和退款（退款表示把捐赠的钱退还给捐助者，用负数表示）：</p>

<pre><code class="language-python">(fec.contb_receipt_amt &gt; 0).value_counts()
</code></pre>

<pre><code>True     991475
False     10256
Name: contb_receipt_amt, dtype: int64
</code></pre>

<p>为了简化之后的分析过程，这里我们只取捐款的数据，不考虑退款的数据：</p>

<pre><code class="language-python">fec = fec[fec.contb_receipt_amt &gt; 0]
</code></pre>

<p>因为Barack Obama和Mitt Romney是两个最主要的候选者，所以这里我们单独准备一个子集来包含二人的数据：</p>

<pre><code class="language-python">fec_mrbo = fec[fec.cand_nm.isin(['Obama, Barack', 'Romney, Mitt'])]
</code></pre>

<h1 id="1-donation-statistics-by-occupation-and-employer-按职业与雇主划分的捐赠数据">1 Donation Statistics by Occupation and Employer（按职业与雇主划分的捐赠数据）</h1>

<p>职业与捐赠也是有关系的。例如，律师倾向于给民主党（Democrats）捐更多的钱，而企业主管（business executives）倾向给共和党（Republicans）捐更多的钱。</p>

<p>首先，按职业计算捐赠总额：</p>

<pre><code class="language-python">fec.contbr_occupation.value_counts()[:10]
</code></pre>

<pre><code>RETIRED                                   233990
INFORMATION REQUESTED                      35107
ATTORNEY                                   34286
HOMEMAKER                                  29931
PHYSICIAN                                  23432
INFORMATION REQUESTED PER BEST EFFORTS     21138
ENGINEER                                   14334
TEACHER                                    13990
CONSULTANT                                 13273
PROFESSOR                                  12555
Name: contbr_occupation, dtype: int64
</code></pre>

<p>可以看到有些职业是同一种工作类型，指代的是同一个东西。下面用一小段代码来清理一下，把一些职业映射为另一种；注意dict.get方法，它会无视没有映射关系的职业：</p>

<pre><code class="language-python">occ_mapping = {
    'INFORMATION REQUESTED PER BEST EFFORTS' : 'NOT PROVIDED',
    'INFORMATION REQUESTED' : 'NOT PROVIDED',
    'INFORMATION REQUESTED (BEST EFFORTS)' : 'NOT PROVIDED',
    'C.E.O.': 'CEO'
}

# If no mapping provided, return x
f = lambda x: occ_mapping.get(x, x)
fec.contbr_occupation = fec.contbr_occupation.map(f)
</code></pre>

<pre><code>/Users/xu/anaconda/envs/py35/lib/python3.5/site-packages/pandas/core/generic.py:3110: SettingWithCopyWarning:
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy
  self[name] = value
</code></pre>

<p>译者：上面这个warning我觉得也有必要好好了解一下，这个网站做了很好的讲解，<a href="https://www.dataquest.io/blog/settingwithcopywarning/">Understanding SettingwithCopyWarning in pandas</a>。</p>

<p>简单的说，pandas会在遇到Chained assignment的情况时，跳出这个SettingWithCopyWarning。Chained assignment指的是<code>data[data.bidder == 'parakeet2004']['bidderrate'] = 100</code>这样的情况，即把两个索引操作连在一起。</p>

<ul>
<li>data[data.bidder == &lsquo;parakeet2004&rsquo;]</li>
<li>[&lsquo;bidderrate&rsquo;] = 100</li>
</ul>

<p>这两个连续操作是分别独立执行的，一个结束后，另一个才开始。第一个操作是一个访问（access）方法，这个方法会返回一个新的DataFrame。而第二个方法是一个赋值（assignment）方法，这个方法是作用在新产生的DataFrame上，所以这里的100是赋给了新的DataFrame，原始的DataFrame并没有被更改。所以为了防止这样的情况出现，pandas会发出SettingWithCopyWarning，让我们检查一下有没有出错。</p>

<p>那就检查一下呗，下面输出fec.contbr_occupation，发现映射关系被正常执行了，所以这里的warning我们可以忽略：</p>

<pre><code class="language-python">fec.contbr_occupation
</code></pre>

<pre><code>0                               RETIRED
1                               RETIRED
2                          NOT PROVIDED
3                               RETIRED
4                               RETIRED
                       ...
1001726                    NOT PROVIDED
1001727                  BUSINESS OWNER
1001728                    NOT PROVIDED
1001729    LONGWALL MAINTENANCE FOREMAN
1001730                    NOT PROVIDED
Name: contbr_occupation, Length: 991475, dtype: object
</code></pre>

<p>对雇主也做同样的映射处理：</p>

<pre><code class="language-python">emp_mapping = {
    'INFORMATION REQUESTED PER BEST EFFORTS' : 'NOT PROVIDED',
    'INFORMATION REQUESTED' : 'NOT PROVIDED',
    'SELF' : 'SELF-EMPLOYED',
    'SELF EMPLOYED' : 'SELF-EMPLOYED',
}

# If no mapping provided, return x
f = lambda x: emp_mapping.get(x, x)
fec.contbr_employer = fec.contbr_employer.map(f)
</code></pre>

<pre><code>/Users/xu/anaconda/envs/py35/lib/python3.5/site-packages/pandas/core/generic.py:3110: SettingWithCopyWarning:
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy
  self[name] = value
</code></pre>

<pre><code class="language-python">fec.contbr_employer
</code></pre>

<pre><code>0                               RETIRED
1                               RETIRED
2                          NOT PROVIDED
3                                  NONE
4                                  NONE
                       ...
1001726                    NOT PROVIDED
1001727    DUFFY EQUIPMENT COMPANY INC.
1001728                    NOT PROVIDED
1001729                        T.A.C.C.
1001730                    NOT PROVIDED
Name: contbr_employer, Length: 991475, dtype: object
</code></pre>

<p>现在，我们可以用pivot_table，按政党和职业对数据进行聚合，然后过滤下得到捐赠额大于两百万美元以上的职业：</p>

<pre><code class="language-python">by_occupation = fec.pivot_table('contb_receipt_amt',
                                index='contbr_occupation',
                                columns='party',
                                aggfunc='sum')
</code></pre>

<pre><code class="language-python">over_2mm = by_occupation[by_occupation.sum(1) &gt; 2000000]
over_2mm
</code></pre>

<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>party</th>
      <th>Democrat</th>
      <th>Republican</th>
    </tr>
    <tr>
      <th>contbr_occupation</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>ATTORNEY</th>
      <td>11141982.97</td>
      <td>7.477194e+06</td>
    </tr>
    <tr>
      <th>CEO</th>
      <td>2074974.79</td>
      <td>4.211041e+06</td>
    </tr>
    <tr>
      <th>CONSULTANT</th>
      <td>2459912.71</td>
      <td>2.544725e+06</td>
    </tr>
    <tr>
      <th>ENGINEER</th>
      <td>951525.55</td>
      <td>1.818374e+06</td>
    </tr>
    <tr>
      <th>EXECUTIVE</th>
      <td>1355161.05</td>
      <td>4.138850e+06</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>PRESIDENT</th>
      <td>1878509.95</td>
      <td>4.720924e+06</td>
    </tr>
    <tr>
      <th>PROFESSOR</th>
      <td>2165071.08</td>
      <td>2.967027e+05</td>
    </tr>
    <tr>
      <th>REAL ESTATE</th>
      <td>528902.09</td>
      <td>1.625902e+06</td>
    </tr>
    <tr>
      <th>RETIRED</th>
      <td>25305116.38</td>
      <td>2.356124e+07</td>
    </tr>
    <tr>
      <th>SELF-EMPLOYED</th>
      <td>672393.40</td>
      <td>1.640253e+06</td>
    </tr>
  </tbody>
</table>
<p>17 rows × 2 columns</p>
</div>

<p>画出柱状图，barh表示水平柱状图：</p>

<pre><code class="language-python">import seaborn as sns
%matplotlib inline
</code></pre>

<pre><code class="language-python">over_2mm.plot(kind='barh', figsize=(10, 8))
</code></pre>

<pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x12bd7d630&gt;
</code></pre>

<p><img src="http://pacdb2bfr.bkt.clouddn.com/blog/image/180708/LHf5icB79B.png?imageslim" alt="mark" /></p>

<p>我们可以能对那些捐款给Obama和Romney的顶级捐助者职业，或顶级捐助公司感兴趣。想要得到这些信息的话，可以按候选者名字进行分组，然后使用top方法的一个变形：</p>

<pre><code class="language-python">def get_top_amounts(group, key, n=5):
    totals = group.groupby(key)['contb_receipt_amt'].sum()
    return totals.nlargest(n)
</code></pre>

<p>然后按职业和雇主聚合：</p>

<pre><code class="language-python">grouped = fec_mrbo.groupby('cand_nm')
grouped
</code></pre>

<pre><code>&lt;pandas.core.groupby.DataFrameGroupBy object at 0x12bed7dd8&gt;
</code></pre>

<pre><code class="language-python">grouped.apply(get_top_amounts, 'contbr_occupation', n=7)
</code></pre>

<pre><code>cand_nm        contbr_occupation
Obama, Barack  RETIRED                  25305116.38
               ATTORNEY                 11141982.97
               INFORMATION REQUESTED     4866973.96
               HOMEMAKER                 4248875.80
               PHYSICIAN                 3735124.94
                                           ...
Romney, Mitt   HOMEMAKER                 8147446.22
               ATTORNEY                  5364718.82
               PRESIDENT                 2491244.89
               EXECUTIVE                 2300947.03
               C.E.O.                    1968386.11
Name: contb_receipt_amt, Length: 14, dtype: float64
</code></pre>

<pre><code class="language-python">grouped.apply(get_top_amounts, 'contbr_employer', n=10)
</code></pre>

<pre><code>cand_nm        contbr_employer
Obama, Barack  RETIRED                  22694358.85
               SELF-EMPLOYED            17080985.96
               NOT EMPLOYED              8586308.70
               INFORMATION REQUESTED     5053480.37
               HOMEMAKER                 2605408.54
                                           ...
Romney, Mitt   CREDIT SUISSE              281150.00
               MORGAN STANLEY             267266.00
               GOLDMAN SACH &amp; CO.         238250.00
               BARCLAYS CAPITAL           162750.00
               H.I.G. CAPITAL             139500.00
Name: contb_receipt_amt, Length: 20, dtype: float64
</code></pre>

<h1 id="2-bucketing-donation-amounts-桶捐赠额">2 Bucketing Donation Amounts（桶捐赠额）</h1>

<p>一个分析这种数据的有用方法是使用cut函数，把捐赠额去中心化，按捐赠额大小分为多个桶：</p>

<pre><code class="language-python">bins = np.array([0, 1, 10, 100, 1000, 10000,
                 100000, 1000000, 10000000])
</code></pre>

<pre><code class="language-python">labels = pd.cut(fec_mrbo.contb_receipt_amt, bins)
labels
</code></pre>

<pre><code>411         (10, 100]
412       (100, 1000]
413       (100, 1000]
414         (10, 100]
415         (10, 100]
             ...
701381      (10, 100]
701382    (100, 1000]
701383        (1, 10]
701384      (10, 100]
701385    (100, 1000]
Name: contb_receipt_amt, Length: 694282, dtype: category
Categories (8, interval[int64]): [(0, 1] &lt; (1, 10] &lt; (10, 100] &lt; (100, 1000] &lt; (1000, 10000] &lt; (10000, 100000] &lt; (100000, 1000000] &lt; (1000000, 10000000]]
</code></pre>

<p>我们可以按二人的名字和箱标签（bin label）分组，得到按不同捐赠额的直方图：</p>

<pre><code class="language-python">grouped = fec_mrbo.groupby(['cand_nm', labels])
grouped.size().unstack(0)
</code></pre>

<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>cand_nm</th>
      <th>Obama, Barack</th>
      <th>Romney, Mitt</th>
    </tr>
    <tr>
      <th>contb_receipt_amt</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>(0, 1]</th>
      <td>493.0</td>
      <td>77.0</td>
    </tr>
    <tr>
      <th>(1, 10]</th>
      <td>40070.0</td>
      <td>3681.0</td>
    </tr>
    <tr>
      <th>(10, 100]</th>
      <td>372280.0</td>
      <td>31853.0</td>
    </tr>
    <tr>
      <th>(100, 1000]</th>
      <td>153991.0</td>
      <td>43357.0</td>
    </tr>
    <tr>
      <th>(1000, 10000]</th>
      <td>22284.0</td>
      <td>26186.0</td>
    </tr>
    <tr>
      <th>(10000, 100000]</th>
      <td>2.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>(100000, 1000000]</th>
      <td>3.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>(1000000, 10000000]</th>
      <td>4.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>

<p>这份数据说明Obama收到的小额捐助是远超Romney的。我们也可以对每一个箱进行归一化，然后得到百分比数据：</p>

<pre><code class="language-python">bucket_sums = grouped.contb_receipt_amt.sum().unstack(0)
bucket_sums
</code></pre>

<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>cand_nm</th>
      <th>Obama, Barack</th>
      <th>Romney, Mitt</th>
    </tr>
    <tr>
      <th>contb_receipt_amt</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>(0, 1]</th>
      <td>318.24</td>
      <td>77.00</td>
    </tr>
    <tr>
      <th>(1, 10]</th>
      <td>337267.62</td>
      <td>29819.66</td>
    </tr>
    <tr>
      <th>(10, 100]</th>
      <td>20288981.41</td>
      <td>1987783.76</td>
    </tr>
    <tr>
      <th>(100, 1000]</th>
      <td>54798531.46</td>
      <td>22363381.69</td>
    </tr>
    <tr>
      <th>(1000, 10000]</th>
      <td>51753705.67</td>
      <td>63942145.42</td>
    </tr>
    <tr>
      <th>(10000, 100000]</th>
      <td>59100.00</td>
      <td>12700.00</td>
    </tr>
    <tr>
      <th>(100000, 1000000]</th>
      <td>1490683.08</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>(1000000, 10000000]</th>
      <td>7148839.76</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>

<pre><code class="language-python">normed_sums = bucket_sums.div(bucket_sums.sum(axis=1), axis=0)
normed_sums
</code></pre>

<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>cand_nm</th>
      <th>Obama, Barack</th>
      <th>Romney, Mitt</th>
    </tr>
    <tr>
      <th>contb_receipt_amt</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>(0, 1]</th>
      <td>0.805182</td>
      <td>0.194818</td>
    </tr>
    <tr>
      <th>(1, 10]</th>
      <td>0.918767</td>
      <td>0.081233</td>
    </tr>
    <tr>
      <th>(10, 100]</th>
      <td>0.910769</td>
      <td>0.089231</td>
    </tr>
    <tr>
      <th>(100, 1000]</th>
      <td>0.710176</td>
      <td>0.289824</td>
    </tr>
    <tr>
      <th>(1000, 10000]</th>
      <td>0.447326</td>
      <td>0.552674</td>
    </tr>
    <tr>
      <th>(10000, 100000]</th>
      <td>0.823120</td>
      <td>0.176880</td>
    </tr>
    <tr>
      <th>(100000, 1000000]</th>
      <td>1.000000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>(1000000, 10000000]</th>
      <td>1.000000</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>

<pre><code class="language-python">normed_sums[:-2].plot(kind='barh', figsize=(10, 8))
</code></pre>

<pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x134735c50&gt;
</code></pre>

<p><img src="http://pacdb2bfr.bkt.clouddn.com/blog/image/180708/FJiEbKGFg8.png?imageslim" alt="mark" /></p>

<p>这里没有包含捐款数额最大的两个bins，因为没有Romney这边没有捐款。</p>

<h1 id="3-donation-statistics-by-state-按州划分的捐赠数据">3 Donation Statistics by State（按州划分的捐赠数据）</h1>

<p>按州划分也是一个比较常见的方法：</p>

<pre><code class="language-python">grouped = fec_mrbo.groupby(['cand_nm', 'contbr_st'])
</code></pre>

<pre><code class="language-python">totals = grouped.contb_receipt_amt.sum().unstack(0).fillna(0)
totals
</code></pre>

<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>cand_nm</th>
      <th>Obama, Barack</th>
      <th>Romney, Mitt</th>
    </tr>
    <tr>
      <th>contbr_st</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>AA</th>
      <td>56405.00</td>
      <td>135.00</td>
    </tr>
    <tr>
      <th>AB</th>
      <td>2048.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>AE</th>
      <td>42973.75</td>
      <td>5680.00</td>
    </tr>
    <tr>
      <th>AK</th>
      <td>281840.15</td>
      <td>86204.24</td>
    </tr>
    <tr>
      <th>AL</th>
      <td>543123.48</td>
      <td>527303.51</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>WI</th>
      <td>1130155.46</td>
      <td>270316.32</td>
    </tr>
    <tr>
      <th>WV</th>
      <td>169154.47</td>
      <td>126725.12</td>
    </tr>
    <tr>
      <th>WY</th>
      <td>194046.74</td>
      <td>252595.84</td>
    </tr>
    <tr>
      <th>XX</th>
      <td>0.00</td>
      <td>400250.00</td>
    </tr>
    <tr>
      <th>ZZ</th>
      <td>5963.00</td>
      <td>0.00</td>
    </tr>
  </tbody>
</table>
<p>67 rows × 2 columns</p>
</div>

<pre><code class="language-python">totals = totals[totals.sum(1) &gt; 100000]
totals
</code></pre>

<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>cand_nm</th>
      <th>Obama, Barack</th>
      <th>Romney, Mitt</th>
    </tr>
    <tr>
      <th>contbr_st</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>AK</th>
      <td>281840.15</td>
      <td>86204.24</td>
    </tr>
    <tr>
      <th>AL</th>
      <td>543123.48</td>
      <td>527303.51</td>
    </tr>
    <tr>
      <th>AR</th>
      <td>359247.28</td>
      <td>105556.00</td>
    </tr>
    <tr>
      <th>AZ</th>
      <td>1506476.98</td>
      <td>1888436.23</td>
    </tr>
    <tr>
      <th>CA</th>
      <td>23824984.24</td>
      <td>11237636.60</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>WA</th>
      <td>4250933.16</td>
      <td>1341521.56</td>
    </tr>
    <tr>
      <th>WI</th>
      <td>1130155.46</td>
      <td>270316.32</td>
    </tr>
    <tr>
      <th>WV</th>
      <td>169154.47</td>
      <td>126725.12</td>
    </tr>
    <tr>
      <th>WY</th>
      <td>194046.74</td>
      <td>252595.84</td>
    </tr>
    <tr>
      <th>XX</th>
      <td>0.00</td>
      <td>400250.00</td>
    </tr>
  </tbody>
</table>
<p>52 rows × 2 columns</p>
</div>

<p>还可以得到每个州，两个候选人获得金额的百分比：</p>

<pre><code class="language-python">percent = totals.div(totals.sum(1), axis=0)
percent[:10]
</code></pre>

<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>cand_nm</th>
      <th>Obama, Barack</th>
      <th>Romney, Mitt</th>
    </tr>
    <tr>
      <th>contbr_st</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>AK</th>
      <td>0.765778</td>
      <td>0.234222</td>
    </tr>
    <tr>
      <th>AL</th>
      <td>0.507390</td>
      <td>0.492610</td>
    </tr>
    <tr>
      <th>AR</th>
      <td>0.772902</td>
      <td>0.227098</td>
    </tr>
    <tr>
      <th>AZ</th>
      <td>0.443745</td>
      <td>0.556255</td>
    </tr>
    <tr>
      <th>CA</th>
      <td>0.679498</td>
      <td>0.320502</td>
    </tr>
    <tr>
      <th>CO</th>
      <td>0.585970</td>
      <td>0.414030</td>
    </tr>
    <tr>
      <th>CT</th>
      <td>0.371476</td>
      <td>0.628524</td>
    </tr>
    <tr>
      <th>DC</th>
      <td>0.810113</td>
      <td>0.189887</td>
    </tr>
    <tr>
      <th>DE</th>
      <td>0.802776</td>
      <td>0.197224</td>
    </tr>
    <tr>
      <th>FL</th>
      <td>0.467417</td>
      <td>0.532583</td>
    </tr>
  </tbody>
</table>
</div>

    </div>

    
    

    
    

    <footer class="post-footer">
      

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/01-%E7%9F%A5%E8%AF%86%E6%A0%91/03-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/01-%E5%9F%BA%E7%A1%80%E7%BC%96%E7%A8%8B/01-%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/02-python/03-python-%E7%A7%91%E5%AD%A6%E8%AE%A1%E7%AE%97/08-%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97/07-%E7%A7%BB%E5%8A%A8%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">07 移动窗口函数</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
          <a class="next" href="/post/01-%E7%9F%A5%E8%AF%86%E6%A0%91/03-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/01-%E5%9F%BA%E7%A1%80%E7%BC%96%E7%A8%8B/01-%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/02-python/03-python-%E7%A7%91%E5%AD%A6%E8%AE%A1%E7%AE%97/11-%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%BE%8B%E5%AD%90/01-usa.gov%E6%95%B0%E6%8D%AE%E9%9B%86/">
            <span class="next-text nav-default">01 USA.gov数据集</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        
  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="iteratelyd@gmail.com" class="iconfont icon-email" title="email"></a>
      <a href="http://github.com/iterateself" class="iconfont icon-github" title="github"></a>
      <a href="https://www.zhihu.com/people/thebegin/activities" class="iconfont icon-zhihu" title="zhihu"></a>
      <a href="https://www.douban.com/people/68028070/" class="iconfont icon-douban" title="douban"></a>
  <a href="http://iterate.site/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> site pv: <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> </span>
    <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> site uv: <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> </span>
  </div>

  <span class="copyright-year">
    &copy; 
    2018
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">iterateself</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
<script src="/lib/highlight/highlight.pack.js?v=20171001"></script><script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>


<script type="text/javascript" src="/dist/even.min.js?v=3.2.0"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script>








</body>
</html>
