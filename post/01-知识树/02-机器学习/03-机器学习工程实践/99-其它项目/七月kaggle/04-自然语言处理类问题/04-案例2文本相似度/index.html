<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>04 案例2：文本相似度 - 迭代自己</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="iterateself" />
  <meta name="description" content="比赛地址 Kaggle竞赛题：https://www.kaggle.com/c/home-depot-product-search-relev" />

  <meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.47.1" />


<link rel="canonical" href="http://iterate.site/post/01-%E7%9F%A5%E8%AF%86%E6%A0%91/02-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/03-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/99-%E5%85%B6%E5%AE%83%E9%A1%B9%E7%9B%AE/%E4%B8%83%E6%9C%88kaggle/04-%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86%E7%B1%BB%E9%97%AE%E9%A2%98/04-%E6%A1%88%E4%BE%8B2%E6%96%87%E6%9C%AC%E7%9B%B8%E4%BC%BC%E5%BA%A6/" />

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">




<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<link href="/dist/even.min.css?v=3.2.0" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">




<meta property="og:title" content="04 案例2：文本相似度" />
<meta property="og:description" content="比赛地址 Kaggle竞赛题：https://www.kaggle.com/c/home-depot-product-search-relev" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://iterate.site/post/01-%E7%9F%A5%E8%AF%86%E6%A0%91/02-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/03-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/99-%E5%85%B6%E5%AE%83%E9%A1%B9%E7%9B%AE/%E4%B8%83%E6%9C%88kaggle/04-%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86%E7%B1%BB%E9%97%AE%E9%A2%98/04-%E6%A1%88%E4%BE%8B2%E6%96%87%E6%9C%AC%E7%9B%B8%E4%BC%BC%E5%BA%A6/" /><meta property="article:published_time" content="2018-07-24T17:25:47&#43;00:00"/>
<meta property="article:modified_time" content="2018-07-24T17:25:47&#43;00:00"/>
<meta itemprop="name" content="04 案例2：文本相似度">
<meta itemprop="description" content="比赛地址 Kaggle竞赛题：https://www.kaggle.com/c/home-depot-product-search-relev">


<meta itemprop="datePublished" content="2018-07-24T17:25:47&#43;00:00" />
<meta itemprop="dateModified" content="2018-07-24T17:25:47&#43;00:00" />
<meta itemprop="wordCount" content="2484">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="04 案例2：文本相似度"/>
<meta name="twitter:description" content="比赛地址 Kaggle竞赛题：https://www.kaggle.com/c/home-depot-product-search-relev"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">迭代自己</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/recent/">
        <li class="mobile-menu-item">最新</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">归档</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">关于</li>
      </a><a href="/catalog/">
        <li class="mobile-menu-item">完整目录</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">迭代自己</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/recent/">最新</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">归档</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">关于</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/catalog/">完整目录</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">04 案例2：文本相似度</h1>

      <div class="post-meta">
        <span class="post-time"> 2018-07-24 </span>
        
        <span class="more-meta"> 2484 words </span>
        <span class="more-meta"> 5 mins read </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> times read </span>
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  
  <div class="post-toc-content">
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#比赛地址">比赛地址</a></li>
</ul></li>
<li><a href="#关键词搜索">关键词搜索</a>
<ul>
<li><a href="#step1-导入所需">Step1：导入所需</a></li>
<li><a href="#step-2-文本预处理">Step 2: 文本预处理</a></li>
<li><a href="#step-3-自制文本特征">Step 3: 自制文本特征</a>
<ul>
<li>
<ul>
<li><a href="#关键词的长度">关键词的长度：</a></li>
<li><a href="#标题中有多少关键词重合">标题中有多少关键词重合</a></li>
<li><a href="#描述中有多少关键词重合">描述中有多少关键词重合</a></li>
</ul></li>
</ul></li>
<li><a href="#step-4-重塑训练-测试集">Step 4: 重塑训练/测试集</a>
<ul>
<li>
<ul>
<li><a href="#分开训练和测试集">分开训练和测试集</a></li>
<li><a href="#记录下测试集的id">记录下测试集的id</a></li>
<li><a href="#分离出y-train">分离出y_train</a></li>
<li><a href="#把原集中的label给删去">把原集中的label给删去</a></li>
</ul></li>
</ul></li>
<li><a href="#step-5-建立模型">Step 5: 建立模型</a></li>
<li><a href="#step-6-上传结果">Step 6: 上传结果</a></li>
<li><a href="#总结">总结：</a></li>
</ul></li>
</ul>
</nav>
  </div>
</div>

    
    

    
    <div class="post-content">
      

<h2 id="比赛地址">比赛地址</h2>

<p>Kaggle竞赛题：<a href="https://www.kaggle.com/c/home-depot-product-search-relevance">https://www.kaggle.com/c/home-depot-product-search-relevance</a></p>

<p>这是一个五金类商品的网站，牛逼之处在于只需要在搜索框内告诉比如：我要打地基。</p>

<p>也就是说这个网站就是一个垂直领域的 google ，直接搜索就行。因为通用的搜索已经有 google了，但是垂直领域的搜索还是可以做的。</p>

<p>他找了很多人，来评价我的之前返回的数据是否准确。准确的是3分，不准确的是1分。</p>

<p>这些所有的标注好的数据，</p>

<p>相似度检测</p>

<h1 id="关键词搜索">关键词搜索</h1>

<p>鉴于课件里已经完整的 show 了 NLTK 在各个 NLP 处理上的用法，我这里就不再重复使用了。</p>

<p>本篇的教程里会尽量用点不一样的库，让大家感受一下 Python NLP 领域各个库的优缺点。<span style="color:red;">好的。</span></p>

<h2 id="step1-导入所需">Step1：导入所需</h2>

<p>所有要用到的库</p>

<pre><code class="language-python">import numpy as np
import pandas as pd
from sklearn.ensemble import RandomForestRegressor, BaggingRegressor
from nltk.stem.snowball import SnowballStemmer
</code></pre>

<p>读入训练/测试集</p>

<pre><code class="language-python">df_train = pd.read_csv('../input/train.csv', encoding=&quot;ISO-8859-1&quot;)
df_test = pd.read_csv('../input/test.csv', encoding=&quot;ISO-8859-1&quot;)
</code></pre>

<p>这里还有个有用的玩意儿，叫产品介绍</p>

<pre><code class="language-python">df_desc = pd.read_csv('../input/product_descriptions.csv')
</code></pre>

<p>产品介绍就是：比如说是 AA Battery ，那么这个 desc 里面就会对这进行解释，说是一个规格为 AA 的电池。</p>

<p>这个是有用的，因为我们需要更多的信息来支撑我们的搜索。</p>

<p>看看数据们都长什么样子。</p>

<pre><code class="language-python">df_train.head()
</code></pre>

<table>
<thead>
<tr>
<th></th>
<th>id</th>
<th>product_uid</th>
<th>product_title</th>
<th>search_term</th>
<th>relevance</th>
</tr>
</thead>

<tbody>
<tr>
<td>0</td>
<td>2</td>
<td>100001</td>
<td>Simpson Strong-Tie 12-Gauge Angle</td>
<td>angle bracket</td>
<td>3.00</td>
</tr>

<tr>
<td>1</td>
<td>3</td>
<td>100001</td>
<td>Simpson Strong-Tie 12-Gauge Angle</td>
<td>l bracket</td>
<td>2.50</td>
</tr>

<tr>
<td>2</td>
<td>9</td>
<td>100002</td>
<td>BEHR Premium Textured DeckOver 1-gal. #SC-141 &hellip;</td>
<td>deck over</td>
<td>3.00</td>
</tr>

<tr>
<td>3</td>
<td>16</td>
<td>100005</td>
<td>Delta Vero 1-Handle Shower Only Faucet Trim Ki&hellip;</td>
<td>rain shower head</td>
<td>2.33</td>
</tr>

<tr>
<td>4</td>
<td>17</td>
<td>100005</td>
<td>Delta Vero 1-Handle Shower Only Faucet Trim Ki&hellip;</td>
<td>shower only faucet</td>
<td>2.67</td>
</tr>
</tbody>
</table>

<pre><code class="language-python">df_desc.head()
</code></pre>

<table>
<thead>
<tr>
<th></th>
<th>product_uid</th>
<th>product_description</th>
</tr>
</thead>

<tbody>
<tr>
<td>0</td>
<td>100001</td>
<td>Not only do angles make joints stronger, they &hellip;</td>
</tr>

<tr>
<td>1</td>
<td>100002</td>
<td>BEHR Premium Textured DECKOVER is an innovativ&hellip;</td>
</tr>

<tr>
<td>2</td>
<td>100003</td>
<td>Classic architecture meets contemporary design&hellip;</td>
</tr>

<tr>
<td>3</td>
<td>100004</td>
<td>The Grape Solar 265-Watt Polycrystalline PV So&hellip;</td>
</tr>

<tr>
<td>4</td>
<td>100005</td>
<td>Update your bathroom with the Delta Vero Singl&hellip;</td>
</tr>
</tbody>
</table>

<p>嗯，更多的描述信息是在 desc 里面的。</p>

<p>对于这种特别复杂的数据，我么要做的事情就是统一预处理。</p>

<p>看来不要做太多的复杂处理，我们于是直接合并测试/训练集，以便于统一做进一步的文本预处理：</p>

<pre><code class="language-python">df_all = pd.concat((df_train, df_test),
                   axis=0,
                   ignore_index=True)
</code></pre>

<pre><code class="language-python">df_all.head()
</code></pre>

<table>
<thead>
<tr>
<th></th>
<th>id</th>
<th>product_title</th>
<th>product_uid</th>
<th>relevance</th>
<th>search_term</th>
</tr>
</thead>

<tbody>
<tr>
<td>0</td>
<td>2</td>
<td>Simpson Strong-Tie 12-Gauge Angle</td>
<td>100001</td>
<td>3.00</td>
<td>angle bracket</td>
</tr>

<tr>
<td>1</td>
<td>3</td>
<td>Simpson Strong-Tie 12-Gauge Angle</td>
<td>100001</td>
<td>2.50</td>
<td>l bracket</td>
</tr>

<tr>
<td>2</td>
<td>9</td>
<td>BEHR Premium Textured DeckOver 1-gal. #SC-141 &hellip;</td>
<td>100002</td>
<td>3.00</td>
<td>deck over</td>
</tr>

<tr>
<td>3</td>
<td>16</td>
<td>Delta Vero 1-Handle Shower Only Faucet Trim Ki&hellip;</td>
<td>100005</td>
<td>2.33</td>
<td>rain shower head</td>
</tr>

<tr>
<td>4</td>
<td>17</td>
<td>Delta Vero 1-Handle Shower Only Faucet Trim Ki&hellip;</td>
<td>100005</td>
<td>2.67</td>
<td>shower only faucet</td>
</tr>
</tbody>
</table>

<p>看一下合并之后的数量:</p>

<pre><code class="language-python">df_all.shape
</code></pre>

<pre><code>(240760, 5)
</code></pre>

<p>有 24 万条数据，与之前的两千条数据的例子比起来就算数据量比较高的。</p>

<p>产品介绍也是一个极有用的信息，我们把它拿过来：<span style="color:red;">merge 还是要掌握的，合并的过程还是很方便的</span></p>

<pre><code class="language-python">df_all = pd.merge(df_all,
                   df_desc,
                   how='left',
                   on='product_uid')
</code></pre>

<pre><code class="language-python">df_all.head()
</code></pre>

<table>
<thead>
<tr>
<th></th>
<th>id</th>
<th>product_title</th>
<th>product_uid</th>
<th>relevance</th>
<th>search_term</th>
<th>product_description</th>
</tr>
</thead>

<tbody>
<tr>
<td>0</td>
<td>2</td>
<td>Simpson Strong-Tie 12-Gauge Angle</td>
<td>100001</td>
<td>3.00</td>
<td>angle bracket</td>
<td>Not only do angles make joints stronger, they &hellip;</td>
</tr>

<tr>
<td>1</td>
<td>3</td>
<td>Simpson Strong-Tie 12-Gauge Angle</td>
<td>100001</td>
<td>2.50</td>
<td>l bracket</td>
<td>Not only do angles make joints stronger, they &hellip;</td>
</tr>

<tr>
<td>2</td>
<td>9</td>
<td>BEHR Premium Textured DeckOver 1-gal. #SC-141 &hellip;</td>
<td>100002</td>
<td>3.00</td>
<td>deck over</td>
<td>BEHR Premium Textured DECKOVER is an innovativ&hellip;</td>
</tr>

<tr>
<td>3</td>
<td>16</td>
<td>Delta Vero 1-Handle Shower Only Faucet Trim Ki&hellip;</td>
<td>100005</td>
<td>2.33</td>
<td>rain shower head</td>
<td>Update your bathroom with the Delta Vero Singl&hellip;</td>
</tr>

<tr>
<td>4</td>
<td>17</td>
<td>Delta Vero 1-Handle Shower Only Faucet Trim Ki&hellip;</td>
<td>100005</td>
<td>2.67</td>
<td>shower only faucet</td>
<td>Update your bathroom with the Delta Vero Singl&hellip;</td>
</tr>
</tbody>
</table>

<p>好了，现在我们得到一个全体的数据大表格</p>

<p>接下来就是文本域处理。</p>

<h2 id="step-2-文本预处理">Step 2: 文本预处理</h2>

<p>我们这里遇到的文本预处理比较简单，因为最主要的就是看关键词是否会被包含。</p>

<p>所以我们统一化我们的文本内容，以达到任何 term 在我们的数据集中只有一种表达式的效果。</p>

<p>在搜索领域，词形归一是非常重要的。</p>

<p>我们这里用简单的 Stem 做个例子：</p>

<p>（有兴趣的同学可以选用各种你觉得靠谱的预处理方式：去掉停止词，纠正拼写，去掉数字，去掉各种emoji，等等）</p>

<pre><code class="language-python">stemmer = SnowballStemmer('english')

def str_stemmer(s):
    return &quot; &quot;.join([stemmer.stem(word) for word in s.lower().split()])
</code></pre>

<p>为了计算『关键词』的有效性，我们可以 naive 地直接看『出现了多少次』</p>

<pre><code class="language-python">def str_common_word(str1, str2):
    return sum(int(str2.find(word)&gt;=0) for word in str1.split())
</code></pre>

<p>str1 是搜索string，str2 是 produce string，我们看 str1 里面出现的单词在 str2 里面出现的次数。</p>

<p>在文本处理这件事的时候，之前我们在案例 1 里面都是直接调用的 tf-idf 或者 词频率统计。这里我们讲的就是怎么创建自己想要的特征。这个是这个比赛不一样的地方，因为一般情况下都是直接调用第三方库就可以解决了。</p>

<p>接下来，就用这两个方法把每一个column都跑一遍，以清洁所有的文本内容</p>

<pre><code class="language-python">df_all['search_term'] = df_all['search_term'].map(lambda x:str_stemmer(x))
</code></pre>

<pre><code class="language-python">df_all['product_title'] = df_all['product_title'].map(lambda x:str_stemmer(x))
</code></pre>

<pre><code class="language-python">df_all['product_description'] = df_all['product_description'].map(lambda x:str_stemmer(x))
</code></pre>

<p>OK，这样数据已经是词形统一了。</p>

<h2 id="step-3-自制文本特征">Step 3: 自制文本特征</h2>

<p>一般属于一种脑洞大开的过程，想到什么可以加什么。</p>

<p>当然，特征也不是越丰富越好，稍微靠谱点是肯定的。</p>

<p>完全取决于</p>

<h4 id="关键词的长度">关键词的长度：</h4>

<pre><code class="language-python">df_all['len_of_query'] = df_all['search_term'].map(lambda x:len(x.split())).astype(np.int64)
</code></pre>

<p><span style="color:red;">可见，特征工程在自然语言处理中就是这么简单。就是脑洞，把它有意义的东西更好的表达出来。这是在文本处理中非常典型的自制文本特征的方式。可以做很多的事情，一些通用的做法还是要收集一下的。</span></p>

<p><span style="color:red;">这个也能作为特征吗？</span></p>

<p><span style="color:red;"></span></p>

<h4 id="标题中有多少关键词重合">标题中有多少关键词重合</h4>

<pre><code class="language-python">df_all['commons_in_title'] = df_all.apply(lambda x:str_common_word(x['search_term'],x['product_title']), axis=1)
</code></pre>

<p>嗯，这个也是不错的特征。</p>

<h4 id="描述中有多少关键词重合">描述中有多少关键词重合</h4>

<pre><code class="language-python">df_all['commons_in_desc'] = df_all.apply(lambda x:str_common_word(x['search_term'],x['product_description']), axis=1)
</code></pre>

<p>嗯，这个也是不错的特征。</p>

<p>等等等等。。变着法子想出些数字能代表的 features，一股脑放进来~可以放很多的不同的内容，各种 feature 。乱七八糟的什么都可以加。</p>

<p>比如可以把 search_term 和 product_title 都表达成 word2vec，然后把这两个vec 之间的夹角值作为一个特征。<span style="color:red;">这也行。</span></p>

<p>实际上一般是越多越好的，尤其是通过 gbdt 来做，两重随机性基本可以避免毫无用处的 feature 来扰乱我们的分类。</p>

<p>搞完之后，我们把不能被『机器学习模型』处理的 column 给 drop 掉。因为他们是文本，在我们真正使用模型进行训练的过程中不能被机器所处理的。</p>

<pre><code class="language-python">df_all = df_all.drop(['search_term','product_title','product_description'],axis=1)
</code></pre>

<h2 id="step-4-重塑训练-测试集">Step 4: 重塑训练/测试集</h2>

<p>舒淇说得好，要把之前脱下的衣服再一件件穿回来。</p>

<p>如果你在之前你为了简便，把一些东西合起来，处理了，那么你真正要跑模型的时候，在按照你顺序把该处理的重新处理回来。</p>

<p>数据处理也是如此，搞完一圈预处理之后，我们让数据重回原本的样貌</p>

<h4 id="分开训练和测试集">分开训练和测试集</h4>

<pre><code class="language-python">df_train = df_all.loc[df_train.index]
df_test = df_all.loc[df_test.index]
</code></pre>

<p>根据之前的 index 来吧 df_all 划分开。</p>

<h4 id="记录下测试集的id">记录下测试集的id</h4>

<p>留着上传的时候，能对的上号。</p>

<pre><code class="language-python">test_ids = df_test['id']
</code></pre>

<h4 id="分离出y-train">分离出y_train</h4>

<pre><code class="language-python">y_train = df_train['relevance'].values
</code></pre>

<h4 id="把原集中的label给删去">把原集中的label给删去</h4>

<p>否则就是cheating了</p>

<pre><code class="language-python">X_train = df_train.drop(['id','relevance'],axis=1).values
X_test = df_test.drop(['id','relevance'],axis=1).values
</code></pre>

<p>嗯，id 也要去掉。</p>

<h2 id="step-5-建立模型">Step 5: 建立模型</h2>

<p>我们用个最简单的模型：RandomForest 回归模型</p>

<pre><code class="language-python">from sklearn.ensemble import RandomForestRegressor
from sklearn.model_selection import cross_val_score
</code></pre>

<p>用 CV 结果保证公正客观性；并调试不同的alpha值</p>

<pre><code class="language-python">params = [1,3,5,6,7,8,9,10]
test_scores = []
for param in params:
    clf = RandomForestRegressor(n_estimators=30, max_depth=param)
    test_score = np.sqrt(-cross_val_score(clf, X_train, y_train, cv=5, scoring='neg_mean_squared_error'))
    test_scores.append(np.mean(test_score))
</code></pre>

<p>画个图来看看：</p>

<pre><code class="language-python">import matplotlib.pyplot as plt
%matplotlib inline
plt.plot(params, test_scores)
plt.title(&quot;Param vs CV Error&quot;);
</code></pre>

<p><img src="http://pacdb2bfr.bkt.clouddn.com/blog/image/180724/BIH8lDCmDg.png?imageslim" alt="mark" /></p>

<p>大概6~7的时候达到了最优解</p>

<h2 id="step-6-上传结果">Step 6: 上传结果</h2>

<p>用我们测试出的最优解建立模型，并跑跑测试集</p>

<pre><code class="language-python">rf = RandomForestRegressor(n_estimators=30, max_depth=6)
</code></pre>

<pre><code class="language-python">rf.fit(X_train, y_train)
</code></pre>

<pre><code>RandomForestRegressor(bootstrap=True, criterion='mse', max_depth=6,
           max_features='auto', max_leaf_nodes=None,
           min_impurity_split=1e-07, min_samples_leaf=1,
           min_samples_split=2, min_weight_fraction_leaf=0.0,
           n_estimators=30, n_jobs=1, oob_score=False, random_state=None,
           verbose=0, warm_start=False)
</code></pre>

<pre><code class="language-python">y_pred = rf.predict(X_test)
</code></pre>

<p>把拿到的结果，放进 PD，做成CSV上传：</p>

<pre><code class="language-python">pd.DataFrame({&quot;id&quot;: test_ids, &quot;relevance&quot;: y_pred}).to_csv('submission.csv',index=False)
</code></pre>

<h2 id="总结">总结：</h2>

<p>这一篇教程中，虽然都是用的最简单的方法，但是基本框架是很完整的。</p>

<p>同学们可以尝试修改/调试/升级的部分是：</p>

<ol>
<li><p><strong>文本预处理步骤</strong>: 你可以使用很多不同的方法来使得文本数据变得更加清洁。这里只是使用了简单的 stemmer，可以使用lemma+词性</p></li>

<li><p><strong>自制的特征</strong>: 相处更多的特征值表达方法（关键词全段重合数量，重合比率，等等）</p></li>

<li><p><strong>更好的回归模型</strong>: 根据之前的课讲的Ensemble方法，把分类器提升到极致</p></li>
</ol>

<p>嗯，还是有很多可以改进的地方的。</p>

    </div>

    
    

    
    

    <footer class="post-footer">
      

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/01-%E7%9F%A5%E8%AF%86%E6%A0%91/02-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/03-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/99-%E5%85%B6%E5%AE%83%E9%A1%B9%E7%9B%AE/%E4%B8%83%E6%9C%88kaggle/04-%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86%E7%B1%BB%E9%97%AE%E9%A2%98/05-%E6%A1%88%E4%BE%8B2%E6%96%87%E6%9C%AC%E7%9B%B8%E4%BC%BC%E5%BA%A6-advance/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">05 案例2：文本相似度 advance</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
          <a class="next" href="/post/01-%E7%9F%A5%E8%AF%86%E6%A0%91/02-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/03-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/99-%E5%85%B6%E5%AE%83%E9%A1%B9%E7%9B%AE/%E4%B8%83%E6%9C%88kaggle/04-%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86%E7%B1%BB%E9%97%AE%E9%A2%98/03-%E6%A1%88%E4%BE%8B1news-stock-advance/">
            <span class="next-text nav-default">03 案例1：news stock advance</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        
  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="iteratelyd@gmail.com" class="iconfont icon-email" title="email"></a>
      <a href="http://github.com/iterateself" class="iconfont icon-github" title="github"></a>
      <a href="https://www.zhihu.com/people/thebegin/activities" class="iconfont icon-zhihu" title="zhihu"></a>
      <a href="https://www.douban.com/people/68028070/" class="iconfont icon-douban" title="douban"></a>
  <a href="http://iterate.site/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> site pv: <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> </span>
    <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> site uv: <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> </span>
  </div>

  <span class="copyright-year">
    &copy; 
    2018
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">iterateself</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
<script src="/lib/highlight/highlight.pack.js?v=20171001"></script><script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>


<script type="text/javascript" src="/dist/even.min.js?v=3.2.0"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script>








</body>
</html>
